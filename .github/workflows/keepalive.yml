name: Keep workflows alive (API mode)

on:
  schedule:
    # 每 30 天执行一次（你可以按需调整频率，只要 < 60 天就行）
    - cron: "0 0 */30 * *"
  workflow_dispatch:  # 可选：支持手动触发

# 需要对 actions 有写权限，才能调用 enable API
permissions:
  actions: write

jobs:
  keepalive:
    runs-on: ubuntu-latest

    steps:
      - name: Keep target workflows enabled via GitHub API
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            // 需要保活的 workflow 列表（文件名形式）
            // 注意：这里的名字必须和 .github/workflows 下的文件名完全一致
            const workflows = [
              'auto_checkin.yaml',
              'keepalive.yml',
            ];

            for (const workflowId of workflows) {
              core.info(`Enabling workflow: ${workflowId}`);
              await github.request(
                'PUT /repos/{owner}/{repo}/actions/workflows/{workflow_id}/enable',
                {
                  owner,
                  repo,
                  workflow_id: workflowId,
                }
              );
              core.info(`Workflow ${workflowId} enabled.`);
            }
